{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "blinking_air_status",
    "name" : "Blinking Air Status",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 7.5,
      "sizeY" : 3,
      "resources" : [ ],
      "templateHtml" : "<div class=\"widget-container\" ng-if=\"ctx && ctx.imageToShow\">\r\n  <img ng-class=\"{'widget-img': true, 'widget-blink': ctx.shouldBlink}\" \r\n       ng-src=\"{{ctx.imageToShow}}\" \r\n       alt=\"Estado atual\" />\r\n  <div class=\"widget-text\">{{ctx.stateText}}</div>\r\n</div>\r\n\r\n<!-- Fallback se não carregou -->\r\n<div class=\"widget-container\" ng-if=\"!ctx || !ctx.imageToShow\">\r\n  <div class=\"widget-text\">Erro ou sem dados</div>\r\n</div>\r\n",
      "templateCss" : ".widget-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border: 2px solid #ddd;\r\n  border-radius: 16px;\r\n  padding: 20px;\r\n  background-color: #fff;\r\n  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);\r\n  height: 100%;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  text-align: center;\r\n}\r\n\r\n.widget-img {\r\n  height: 100px;\r\n  max-width: 100%;\r\n  transition: opacity 0.3s ease-in-out;\r\n}\r\n\r\n.widget-blink {\r\n  animation: blink 1.2s infinite;\r\n}\r\n\r\n@keyframes blink {\r\n  0%, 100% { opacity: 1; }\r\n  50% { opacity: 0.3; }\r\n}\r\n\r\n.widget-text {\r\n  margin-top: 12px;\r\n  font-size: 1.2em;\r\n  font-weight: 600;\r\n  color: #333;\r\n}\r\n",
      "controllerScript" : "self.onInit = function () {\r\n  if (!self.ctx || !self.ctx.data || !self.ctx.data.length) {\r\n    console.warn(\"Contexto inválido no widget\");\r\n    return;\r\n  }\r\n\r\n  const settings = self.ctx.settings || {};\r\n  const dataKeySettings = self.ctx.data[0]?.dataKey?.settings || {};\r\n\r\n  const vm = self.ctx;\r\n  vm.stateText = dataKeySettings.noDataText || 'Sem dados';\r\n  vm.shouldBlink = false;\r\n  vm.imageToShow = settings.offImageUrl || '';\r\n\r\n  const threshold = settings.threshold ?? 100;\r\n  const blinkInterval = settings.blinkInterval ?? 1200;\r\n  const onImage = settings.onImageUrl || '';\r\n  const offImage = settings.offImageUrl || '';\r\n  const highlightColor = dataKeySettings.highlightColor || '#2196f3';\r\n\r\n  self.onDataUpdated = function () {\r\n    try {\r\n      const value = self.ctx.data[0]?.data?.[0]?.[1];\r\n\r\n      if (value == null) {\r\n        vm.stateText = dataKeySettings.noDataText || 'Sem dados';\r\n        vm.imageToShow = offImage;\r\n        vm.shouldBlink = false;\r\n        return;\r\n      }\r\n\r\n      const ativo = value >= threshold;\r\n\r\n      vm.stateText = ativo ? 'Ligado' : 'Desligado';\r\n      vm.imageToShow = ativo ? onImage : offImage;\r\n      vm.shouldBlink = ativo;\r\n    } catch (e) {\r\n      console.error(\"Erro no widget:\", e);\r\n      vm.stateText = 'Erro';\r\n      vm.imageToShow = offImage;\r\n      vm.shouldBlink = false;\r\n    }\r\n  };\r\n};\r\n\r\nself.onResize = function () {};\r\nself.onDestroy = function () {};\r\n",
      "settingsSchema" : "{\r\n  \"schema\": {\r\n    \"type\": \"object\",\r\n    \"title\": \"Configurações do Widget\",\r\n    \"properties\": {\r\n      \"threshold\": {\r\n        \"title\": \"Limite para estado ON\",\r\n        \"type\": \"number\",\r\n        \"default\": 100\r\n      }\r\n    }\r\n  },\r\n  \"form\": [\"threshold\"]\r\n}\r\n",
      "dataKeySettingsSchema" : "{}\n{\n  \"schema\": {\n    \"type\": \"object\",\n    \"title\": \"Configurações por Data Key\",\n    \"properties\": {\n      \"showTooltip\": {\n        \"title\": \"Mostrar valor como tooltip?\",\n        \"type\": \"boolean\",\n        \"default\": true\n      },\n      \"noDataText\": {\n        \"title\": \"Texto para ausência de dados\",\n        \"type\": \"string\",\n        \"default\": \"Sem dados disponíveis\"\n      },\n      \"highlightColor\": {\n        \"title\": \"Cor de destaque (ex: borda, texto)\",\n        \"type\": \"string\",\n        \"default\": \"#4CAF50\"\n      },\n      \"labelPrefix\": {\n        \"title\": \"Prefixo do rótulo\",\n        \"type\": \"string\",\n        \"default\": \"Consumo:\"\n      },\n      \"units\": {\n        \"title\": \"Unidades (ex: kWh)\",\n        \"type\": \"string\",\n        \"default\": \"kWh\"\n      }\n    }\n  },\n  \"form\": [\n    \"showTooltip\",\n    \"noDataText\",\n    {\n      \"key\": \"highlightColor\",\n      \"type\": \"color\"\n    },\n    \"labelPrefix\",\n    \"units\"\n  ]\n}\n",
      "hasBasicMode" : true,
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Attributes card\",\"decimals\":null}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "77ed6d80-4160-11f0-bdaa-1bbe0793dcff"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}